-- Create chain_prices table for price comparison between supermarket chains
CREATE TABLE public.chain_prices (
  id UUID NOT NULL DEFAULT gen_random_uuid() PRIMARY KEY,
  canonical_key TEXT NOT NULL,
  chain_name TEXT NOT NULL,
  price_ils NUMERIC NOT NULL,
  last_updated TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT now(),
  UNIQUE(canonical_key, chain_name)
);

-- Enable RLS
ALTER TABLE public.chain_prices ENABLE ROW LEVEL SECURITY;

-- Allow anyone to read prices
CREATE POLICY "Anyone can read chain prices"
ON public.chain_prices
FOR SELECT
USING (true);

-- Create index for faster lookups
CREATE INDEX idx_chain_prices_canonical_key ON public.chain_prices(canonical_key);

-- Insert sample data for common items across chains
INSERT INTO public.chain_prices (canonical_key, chain_name, price_ils) VALUES
-- חלב
('חלב 3%', 'שופרסל', 7.90),
('חלב 3%', 'רמי לוי', 6.90),
('חלב 3%', 'ויקטורי', 7.50),
('חלב 3%', 'יוחננוף', 7.70),
('חלב 1%', 'שופרסל', 7.50),
('חלב 1%', 'רמי לוי', 6.50),
('חלב 1%', 'ויקטורי', 7.20),
-- ביצים
('ביצים', 'שופרסל', 28.90),
('ביצים', 'רמי לוי', 26.90),
('ביצים', 'ויקטורי', 27.50),
('ביצים', 'יוחננוף', 28.00),
-- לחם
('לחם', 'שופרסל', 8.90),
('לחם', 'רמי לוי', 7.90),
('לחם', 'ויקטורי', 8.50),
('לחם', 'יוחננוף', 8.70),
-- גבינה
('גבינה צהובה', 'שופרסל', 45.90),
('גבינה צהובה', 'רמי לוי', 42.90),
('גבינה צהובה', 'ויקטורי', 44.50),
('גבינה לבנה', 'שופרסל', 8.90),
('גבינה לבנה', 'רמי לוי', 7.90),
('גבינה לבנה', 'ויקטורי', 8.50),
-- פירות
('תפוחים', 'שופרסל', 9.90),
('תפוחים', 'רמי לוי', 8.90),
('תפוחים', 'ויקטורי', 9.50),
('בננות', 'שופרסל', 8.90),
('בננות', 'רמי לוי', 7.90),
('בננות', 'ויקטורי', 8.50),
('תפוזים', 'שופרסל', 7.90),
('תפוזים', 'רמי לוי', 6.90),
('תפוזים', 'ויקטורי', 7.50),
-- ירקות
('עגבניות', 'שופרסל', 8.90),
('עגבניות', 'רמי לוי', 7.90),
('עגבניות', 'ויקטורי', 8.50),
('מלפפונים', 'שופרסל', 6.90),
('מלפפונים', 'רמי לוי', 5.90),
('מלפפונים', 'ויקטורי', 6.50),
('בצל', 'שופרסל', 4.90),
('בצל', 'רמי לוי', 3.90),
('בצל', 'ויקטורי', 4.50),
('תפוחי אדמה', 'שופרסל', 5.90),
('תפוחי אדמה', 'רמי לוי', 4.90),
('תפוחי אדמה', 'ויקטורי', 5.50),
('גזר', 'שופרסל', 4.90),
('גזר', 'רמי לוי', 3.90),
('גזר', 'ויקטורי', 4.50),
-- מוצרי חלב נוספים
('יוגורט', 'שופרסל', 6.90),
('יוגורט', 'רמי לוי', 5.90),
('יוגורט', 'ויקטורי', 6.50),
('קוטג׳', 'שופרסל', 8.90),
('קוטג׳', 'רמי לוי', 7.90),
('קוטג׳', 'ויקטורי', 8.50),
('שמנת', 'שופרסל', 7.90),
('שמנת', 'רמי לוי', 6.90),
('שמנת', 'ויקטורי', 7.50),
('חמאה', 'שופרסל', 12.90),
('חמאה', 'רמי לוי', 11.90),
('חמאה', 'ויקטורי', 12.50);